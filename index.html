<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stra√üenwacht: Connected</title>
    <!-- PWA Integration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://t08acaea86euo6zr.public.blob.vercel-storage.com/android-launchericon-192-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://t08acaea86euo6zr.public.blob.vercel-storage.com/180.png">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="game-card">
        <div class="game-container" id="gameWrapper">
            <canvas id="gameCanvas"></canvas>
            <div id="scoreBoard">0</div>
            <div id="comboText">COMBO x2</div>
            <!-- Powerup UI -->
            <div id="powerupDisplay">
                <span id="powerupIcon" style="font-size: 1.5rem;">üõ°Ô∏è</span>
                <span id="powerupTimer">30s</span>
            </div>
            <div id="repairBarContainer">
                <div id="repairBarFill"></div>
            </div>
            <!-- NAME ENTRY SCREEN (Onboarding) -->
            <div id="nameEntryScreen" class="overlay" style="display: none;">
                <h1 class="game-title" style="margin-bottom: 15px;">Willkommen<br>im Team</h1>
                <p style="margin-bottom: 20px; text-align: center;">Wie ist dein Name, Pannenfahry?</p>
                <!-- SVG Character -->
                <div class="driver-container">
                    <svg class="driver-svg" viewBox="0 0 200 220" xmlns="http://www.w3.org/2000/svg">
                        <path d="M50 220 L50 160 Q50 120 100 120 Q150 120 150 160 L150 220 Z" fill="#ffcd00" />
                        <path d="M80 120 L80 140 Q100 150 120 140 L120 120" fill="#1e293b" />
                        <rect x="85" y="100" width="30" height="30" fill="#ffdbac" />
                        <rect x="65" y="40" width="70" height="90" rx="25" fill="#ffdbac" />
                        <circle cx="60" cy="85" r="8" fill="#ffdbac" />
                        <circle cx="140" cy="85" r="8" fill="#ffdbac" />
                        <path d="M55 60 Q60 20 100 20 Q140 20 145 60 L145 70 Q145 50 135 50 L65 50 Q55 50 55 70 Z" fill="#262626" />
                        <path d="M55 60 L65 60 L65 90 L55 80 Z" fill="#262626" />
                        <path d="M145 60 L135 60 L135 90 L145 80 Z" fill="#262626" />
                        <circle cx="82" cy="80" r="5" fill="#1e293b" />
                        <circle cx="118" cy="80" r="5" fill="#1e293b" />
                        <path d="M75 72 Q82 70 89 72" fill="none" stroke="#262626" stroke-width="3" stroke-linecap="round"/>
                        <path d="M111 72 Q118 70 125 72" fill="none" stroke="#262626" stroke-width="3" stroke-linecap="round"/>
                        <path d="M95 85 L95 95 L105 95" fill="none" stroke="#dca685" stroke-width="2" stroke-linecap="round"/>
                        <path d="M90 105 Q100 110 110 105" fill="none" stroke="#1e293b" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <div id="driverBadge" class="name-tag"></div>
                </div>
                <input type="text" id="initialNameInput" class="highscore-input" placeholder="Name eingeben" maxlength="12">
                <button class="start-btn" id="saveNameBtn">Weiter</button>
            </div>
            <!-- STORY SCREEN (Briefing) -->
            <div id="storyScreen" class="overlay" style="display: none;">
                <h1 class="game-title" style="font-size: 2rem; margin-bottom: 20px; animation: none; text-shadow: none; color: var(--accent-color);">BRIEFING</h1>
                <div class="story-content">
                    <div class="story-line">> Zugriff auf Personalakte... OK.</div>
                    <div class="story-line" style="margin-bottom: 20px;">> Status: Einsatzbereit.</div>
                    <div class="story-line">Bisher mussten wir immer pers√∂nlich raus.</div>
                    <div class="story-line">Hingehen. Anfassen. Reparieren.</div>
                    <div class="story-line" style="margin-top: 20px;">Aber die Stra√üe hat sich ver√§ndert.</div>
                    <div class="story-line">Autos senden jetzt Daten. Fehlercodes.</div>
                    <div class="story-line">Wir empfangen direkt aus dem Motorraum.</div>
                    <div class="story-line" style="margin-top: 20px; color: var(--accent-color); font-weight: bold;">
                        DEINE MISSION STARTET JETZT.
                    </div>
                </div>
                <button class="start-btn" id="finishStoryBtn">Verstanden</button>
            </div>
            <!-- ADMIN OVERLAY -->
            <div id="adminOverlay" class="overlay" style="display:none; z-index: 50;">
                <div class="admin-panel">
                    <div class="admin-title">/// ADMIN KONSOLE ///</div>
                    <div id="adminLoginView">
                        <input type="password" id="adminPassInput" class="highscore-input" placeholder="ACCESS CODE" style="border-color: var(--danger-color); width: 100%;">
                        <button class="admin-footer-btn" id="adminLoginBtn" style="width: 100%;">ZUGRIFF ANFORDERN</button>
                    </div>
                    <div id="adminDataView" style="display:none; flex-direction: column; gap: 10px; height: 100%;">
                        <div class="leaderboard-list" id="adminList" style="flex-grow: 1; min-height: 200px; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px;">
                            <!-- List populated by JS -->
                        </div>
                        <button class="admin-footer-btn" id="forceReloadBtn" style="background: #eab308; color: #000;">‚ôª FORCE RELOAD (PWA)</button>
                        <button class="admin-footer-btn" id="adminResetBtn" style="background: #7f1d1d;">‚ö† ALLES L√ñSCHEN</button>
                        <button class="admin-footer-btn" id="adminCloseDataBtn" style="background: #334155;">SCHLIESSEN</button>
                    </div>
                    <div id="adminCloseBtn" style="text-align: center; margin-top: 10px; cursor: pointer; color: #64748b; font-size: 0.8rem; text-decoration: underline;">Abbruch</div>
                </div>
            </div>
            <!-- UPDATE BANNER -->
            <div id="updateBanner">
                <div class="update-text">SYSTEM UPDATE VERF√úGBAR</div>
                <button class="update-btn" id="applyUpdateBtn">INSTALLIEREN</button>
            </div>
            <!-- START SCREEN -->
            <div id="startScreen" class="overlay" style="display: none;">
                <h1 class="game-title">Stra√üenwacht<br>Connected</h1>
                <div class="game-subtitle">Digital liegenbleiben.</div>
                <p id="welcomeText" style="color: var(--accent-color); font-weight: bold; margin-bottom: 10px;">Hallo, Pannenfahry!</p>
                <div class="leaderboard-panel">
                    <div class="leaderboard-header">/// TOP EINSATZKR√ÑFTE ///</div>
                    <div class="leaderboard-list" id="startLeaderboard">
                        <div style="text-align:center; color:#64748b; padding:10px;">Verbinde mit Zentrale...</div>
                    </div>
                </div>
                <button class="start-btn" id="startGameBtn">Start Engine</button>
                <div style="margin-top: 20px; font-size: 0.8rem; color: #64748b;">
                    Steuerung: Pfeiltasten oder A / D
                </div>
                <div id="logoutBtn" style="margin-top: 10px; font-size: 0.75rem; color: #ef4444; cursor: pointer; text-decoration: underline;">
                    Abmelden / Anderer Fahrer
                </div>
            </div>
            <!-- DIAGNOSTIC OVERLAY (New) -->
            <div id="diagnosticOverlay" class="overlay" style="display: none; background: rgba(0,0,0,0.95); z-index: 30;">
                <!-- Boot Sequence Container -->
                <div id="bootSequence" class="boot-container" style="display: block;">
                    <div id="bootText"></div><span class="terminal-cursor"></span>
                </div>
                <!-- Main Diagnostic UI -->
                <div id="diagContainer" class="diag-container">
                    <div class="diag-header">
                        <span>> CONNECTED CAR INTERFACE</span>
                        <span class="diag-blink">‚óè LIVE</span>
                    </div>
                    <div class="diag-question" id="diagQuestionText">
                        Fehleranalyse l√§uft...
                    </div>
                    <div class="diag-options" id="diagOptionsList">
                        <!-- Options generated by JS -->
                    </div>
                    <button class="diag-confirm-btn" id="diagConfirmBtn">DIAGNOSE SENDEN [ENTER]</button>
                </div>
            </div>
            <!-- GAME OVER SCREEN -->
            <div id="gameOverScreen" class="overlay" style="display: none;">
                <h2 id="gameOverTitle" style="color: var(--danger-color); font-size: 2.5rem; text-transform: uppercase; margin-bottom: 10px;">Unfall!</h2>
                <p style="font-size: 1.1rem; color: #94a3b8; margin-bottom: 20px;">Score: <span id="finalScore" style="color: white; font-weight: bold;">0</span></p>
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="statRepairs">0</span>
                        <span class="stat-label">Pannen</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statMissed" style="color: #ef4444;">0</span>
                        <span class="stat-label">Verpasst</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statDodged" style="color: #3b82f6;">0</span>
                        <span class="stat-label">Verkehr</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statAMDs" style="color: #10b981;">0</span>
                        <span class="stat-label">AMDs</span>
                    </div>
                </div>
                <div id="submittingScoreText" style="color: var(--accent-color); font-family: monospace; margin-bottom: 15px; display: none;">
                    > Sende Daten an Zentrale...
                </div>
                <div id="gameOverLeaderboard" class="leaderboard-panel" style="display: none;">
                    <div class="leaderboard-header">/// RANGLISTE AKTUALISIERT ///</div>
                    <div class="leaderboard-list" id="gameOverLeaderboardList"></div>
                </div>
                <div style="margin-top: 30px;">
                    <p id="resetGameBtn" style="color: #64748b; cursor: pointer; text-decoration: underline;">Leertaste f√ºr Neustart</p>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <div style="font-weight: 600;">
                built with ‚ù§Ô∏è by marcus
            </div>
        <div style="opacity: 0.5; font-family: monospace;">
            ADAC_DEV_BUILD_2026 <span id="adminToggleBtn" style="cursor: pointer; margin-left: 8px;" title="Admin Access">[‚ö°]</span>
            <span style="margin-left: 8px;">|</span>
            <a href="/privacy.html" style="color: inherit; margin-left: 8px; text-decoration: none;" target="_blank">Datenschutz</a>
        </div>
        </div>
    </div>
    <script type="module" src="js/main.js"></script>
</body>
</html>
